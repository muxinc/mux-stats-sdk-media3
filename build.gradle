import org.jetbrains.dokka.gradle.DokkaTaskPartial
// Top-level build file where you can add configuration options common to all sub-projects/modules.
plugins {
  id 'com.android.application' version '8.4.2' apply false
  id 'com.android.library' version '8.4.2' apply false
  id 'org.jetbrains.kotlin.android' version '1.9.24' apply false
  id 'com.mux.gradle.android.mux-android-distribution' version '1.1.2' apply false
  id "org.jetbrains.dokka" version "1.6.10"
}

//findProject("library").tasks.named("artifactoryDeploy") {
//}

//afterEvaluate {
//  project.findProject(":library-exo")
//          .tasks.findByName("artifactoryDeploy")
//          .dependsOn project.tasks.findByName("artifactoryDeploy")
//      dependsOn findProject("library").tasks.findByName("artifactoryDeploy")
//  }

//  project.findProject("library-exo").tasks.register("")

  def deployBase = tasks.register("deployBase") {
    dependsOn ':library:artifactoryPublish'
    mustRunAfter ':library:artifactoryPublish'

    group 'Mux'
  }
  def deployModules = tasks.register("deployModules") {
//    dependsOn ':library-exo:artifactoryPublish'
//    dependsOn ':library-ima:artifactoryPublish'
    finalizedBy ':library-exo:artifactoryPublish'
    finalizedBy ':library-ima:artifactoryPublish'
//    mustRunAfter ':library-exo:artifactoryPublish'
//    mustRunAfter ':library-ima:artifactoryPublish'
    dependsOn deployBase
    mustRunAfter deployBase

    group 'Mux'
  }


  tasks.register("deployInOrder") {
  }
//}
//project.findProject(":library-ima").tasks.named("artifactoryDelpoy") {
//  dependsOn findProject("library").tasks.named("artifactoryDeploy")
//}

allprojects {
  project.ext {
    coreVersion = '1.3.0'
  }

  tasks.withType(DokkaTaskPartial.class) {
    dokkaSourceSets.configureEach {
      //includes.from("README.md")
    }
  }
}

tasks.named("dokkaHtmlMultiModule").configure {
  outputDirectory.set(new File(buildDir, "dokkaOutput"))
}
